var gntp = require('./GNTP.js');

/**
 * Register an application and its notifications.
 */
function register(name, notifications){
	notifications = notifications || ['default'];
	name = name || 'gwrap.js';

	var client = new gntp.Client();
	var app = new gntp.Application(name);

	var appReq = app.toRequest();

	for (var i in notifications) {
		var notification = notifications[i];

		var notify = new gntp.Notification();
		notify.name = notification;
		notify.displayName = notification;

		appReq.addNotification(notify);
	}
	
	client.sendMessage(appReq.toRequest());
}

/**
 * Send a message (for given notification and app)
 */
function send(text, notification, name){
	var client = new gntp.Client();

	notification = notification || 'default';
	name = name || 'gwrap.js';

	var notify = new gntp.Notification();
	notify.name = notification;
	notify.displayName = notification;
	
	var notReq = notify.toRequest();
	notReq.applicationName = name;
	notReq.text = text;

	var msg = notReq.toRequest();
	//msg.headers.addHeader(new gntp.Header(gntp.HeaderEnum.dataHeaderPrefix + 'Blarg', 'blarg'));
	//msg.crypto = new gntp.Crypto('nodejs','sha1');

	client.sendMessage(msg);
}

exports.register = register;
exports.send = send;
